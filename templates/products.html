{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold">All Products</h2>

  {% if current_user.is_authenticated %}
  <a href="/add_product" class="btn btn-success">+ Add Product</a>
  {% endif %}
</div>

<div class="row">
{% for p in products %}
  <div class="col-md-4 mb-4">
    <div class="card h-100 shadow-sm">

      <!-- Product Image -->
      {% if p.image %}
        <img src="{{ url_for('static', filename='uploads/' + p.image) }}"
             class="card-img-top"
             style="height:220px; object-fit:cover;">
      {% else %}
        <img src="https://via.placeholder.com/400x220?text=No+Image"
             class="card-img-top">
      {% endif %}

      <div class="card-body d-flex flex-column">

        <h5 class="card-title">{{ p.name }}</h5>

        <!-- ตัด description ถ้ายาวเกิน -->
        <p class="card-text text-muted">
          {{ p.description[:80] }}{% if p.description|length > 80 %}...{% endif %}
        </p>

        <div class="mt-auto">
          <p class="fw-bold text-success fs-5">{{ p.price }} ฿</p>

          <div class="d-flex gap-2">
            <a href="/product/{{p.id}}" class="btn btn-outline-primary btn-sm w-50">
              View
            </a>

            {% if current_user.is_authenticated %}
            <a href="/checkout/{{p.id}}" class="btn btn-warning btn-sm w-50">
              Buy
            </a>
            {% endif %}
          </div>

        </div>

      </div>
    </div>
  </div>
{% endfor %}
</div>

{% if products|length == 0 %}
  <div class="text-center mt-5">
    <h4>No products available yet</h4>
    {% if current_user.is_authenticated %}
      <a href="/add_product" class="btn btn-primary mt-3">Add First Product</a>
    {% endif %}
  </div>
{% endif %}

{% endblock %}